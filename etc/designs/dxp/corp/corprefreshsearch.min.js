$(document).ready(function() {
 if($(window).width() < 768){
      $('.js-search li.search-list-item').on('touchstart.dropdown.data-api', function(e){
          window.location=$(this).find('a').attr('href');
           //e.stopImmediatePropagation();
    });
     }
const SEARCH = $('.js-search');
const SEARCHFOOTER = SEARCH.find('.search__footer');
var minLengthMsg = $('input[name="minLengthMsg"]').val();
var validationMsg= $('input[name="validationMsg"]').val();

if(minLengthMsg == "" || minLengthMsg == undefined){
  minLengthMsg= "Please enter at least 2 characters";
}
if(validationMsg == "" || validationMsg == undefined) {
  validationMsg= "Please enter only Alphabets & Numbers";
}

function searchBlock() {
  SEARCH.find('input').on('click', function(e) {
    SEARCH
      .addClass('is-show')
      .addClass('is-open');
    let height = SEARCH.find('.search-list').height() + 36;
    $(document).ready(function() {

    	const SEARCH = $('.js-search');
    	const SEARCHFOOTER = SEARCH.find('.search__footer');

    	function searchBlock() {
    	  SEARCH.find('input').on('click', function(e) {
    	    SEARCH
    	      .addClass('is-show')
    	      .addClass('is-open');
    	    let height = SEARCH.find('.search-list').height() + 36;

    	    if ($(window).width() < 767 && SEARCH.hasClass('is-show') && $('.searchpod1').length>0) {
    	      SEARCH.css('margin-bottom', height);
    	    } else {
    	      SEARCH.removeAttr('style');
    	    }
    	    e.stopPropagation();
    	  });

    	  SEARCH.find('.input-button').on('click', function() {
    	    SEARCH
    	      .removeClass('is-show')
    	      .removeClass('is-open')
    	      .removeAttr('style');
    	  });


    	}


    	$(document).mouseup(function(e) {
    	  if (!SEARCH.is(e.target) && SEARCH.has(e.target).length === 0) {
    	    SEARCH
    	      .removeClass('is-show')
    	      .removeClass('is-open')
    	      .removeAttr('style');
    	  }
    	});

    	if ($(window).width() < 767) {
    	  searchBlock();
    	}

    	$(window).on('resize', function() {
    	  if ($(window).width() < 767) {
    	    searchBlock();
    	  }
    	});


    	jQuery(".main-content-wrapper #search_submit").click(function (event) {
    	            event.preventDefault();
    	            var clicked = true;
    	           	var resultinsamepage = $(".main-content-wrapper #resultinsamepage").val();
    				var q = $(".main-content-wrapper #search_value").val();
    				var resultperpage = $('.main-content-wrapper #resultperpage').val();
    				var searchresultresponsepath = $(".main-content-wrapper #searchresultsresppath").val();
    				if(resultinsamepage == "true"){
    							window.location.replace($(".main-content-wrapper #resultPage").val()+".html?searchterm="+q+"&resultperpage="+resultperpage);
    	                    }else {
    							var url = searchresultresponsepath+".response.html?searchterm="+q+"&resultperpage="+resultperpage;
    	                  jQuery.ajax({
    	                         url: url,
    	                         method: "GET",
    	                         success: function(data) {   
    									$('.main-content-wrapper .clearexisting').empty();
    									var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname+"?searchterm="+q+"&resultperpage="+resultperpage;
    									window.history.pushState({path:newurl},'',newurl);
    	                                 jQuery(".main-content-wrapper #search-pod-results").html(data);

    	                                if($('.searchpod1').length>0){
    	                                $('.searchpod1 .pod1 span.more-icon').hide();
    	                                $('.searchpod1 .pod1 span.more-text').addClass('podsearch');
    	                                $('.searchpod1 .pod1 .post-footer').addClass('podfooter');
    	                                $('.searchpod1 .pod1 .post-body-in').addClass('podbody'); 
    	                                $('.template_secondaryPage .hero-white .container-fluid.container-fluid-main').css('padding','0');    
    	                                }
    	                             onYouTubeIframeAPIReady();
    							setTimeout(function(){
    	                    $('.searchpod1 li.page-item.event-page-1').addClass('active'); }, 500);
    							 $('li.post-small.block-white.block').hide();
    	                     $('li.post-small.block-white.block').slice( 10, 10 ).show();
    	                         },
    	                         error: function() {
    	                                }
    	                            });
    	                   }

    	                });

    		jQuery("header #search_submit").click(function (event) {
    	            event.preventDefault();
    	            if($("header #search_value").val().length > 0){
    	            var clicked = true;
    	            var resultinsamepage = $("header #resultinsamepage").val();
    				var q = $("header #search_value").val();
    				var resultperpage = $('header #resultperpage').val();
    				var searchresultresponsepath = $("header #searchresultsresppath").val();
    				var redirectpage = $("header #resultPage").val();
    				if(resultinsamepage == "true"){
    							window.location.replace(redirectpage+".html?searchterm="+q+"&resultperpage="+resultperpage);
    	                    }else {
    							var url = searchresultresponsepath+".response.html?searchterm="+q+"&resultperpage="+resultperpage;
    	                  jQuery.ajax({
    	                         url: url,
    	                         method: "GET",
    	                         success: function(data) {   
    									$('.clearexisting').empty();
    									var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname+"?searchterm="+q+"&resultperpage="+resultperpage;
    									window.history.pushState({path:newurl},'',newurl);
    	                                 jQuery("#search-pod-results").html(data);
    							setTimeout(function(){
    	                    $('.searchpod1 li.page-item.event-page-1').addClass('active'); }, 500);
    							 $('li.post-small.block-white.block').hide();
    	                     $('li.post-small.block-white.block').slice( 10, 10 ).show();
    	                         },
    	                         error: function() {
    	                                }
    	                            });
    	                   }
    	            }
    	                });
    	});	 
    if ($(window).width() < 767 && SEARCH.hasClass('is-show') && $('.searchpod1').length>0) {
      SEARCH.css('margin-bottom', height);
    } else {
      SEARCH.removeAttr('style');
    }
    e.stopPropagation();
  });

  SEARCH.find('.input-button').on('click', function() {
    SEARCH
      .removeClass('is-show')
      .removeClass('is-open')
      .removeAttr('style');
  });


}

$(window).load(function() {
    $("header #search_value").val('');
});
$(document).mouseup(function(e) {
  if (!SEARCH.is(e.target) && SEARCH.has(e.target).length === 0) {
    SEARCH
      .removeClass('is-show')
      .removeClass('is-open')
      .removeAttr('style');
  }
});

if ($(window).width() < 767) {
  searchBlock();
}

$(window).on('resize', function() {
  if ($(window).width() < 767) {
    searchBlock();
  }
});


jQuery(".main-content-wrapper #search_submit").click(function (event) {
            event.preventDefault();
            var clicked = true;
           	var resultinsamepage = $(".main-content-wrapper #resultinsamepage").val();
			var q = $(".main-content-wrapper #search_value").val().trim();
			var searchElem= $(this).parent().find('.show-search-error');
			if(q.length>=2 && !validateSearchInput(q)){
				searchElem.html(validationMsg);
				searchElem.removeClass('hidden');
				return false;
			} else if(q.length<2){
				searchElem.html(minLengthMsg);
				searchElem.removeClass('hidden');
				return false;
			}
			var resultperpage = $('.main-content-wrapper #resultperpage').val();
			var searchresultresponsepath = $(".main-content-wrapper #searchresultsresppath").val(); 
			if(resultinsamepage == "true"){
						window.location.replace($(".main-content-wrapper #resultPage").val()+".html?searchterm="+q+"&resultperpage="+resultperpage);
                    }else {
						var url = searchresultresponsepath+".searchresults.html?searchterm="+q+"&resultperpage="+resultperpage;
                  jQuery.ajax({
                         url: url,
                         method: "GET",
                         success: function(data) {   
								if(!$('.main-content-wrapper').find('.show-search-error').hasClass('hidden')){
									$('.main-content-wrapper').find('.show-search-error').addClass('hidden');
								}
								$('.main-content-wrapper .clearexisting').empty();
								var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname+"?searchterm="+q+"&resultperpage="+resultperpage;
								window.history.pushState({path:newurl},'',newurl);
                                 jQuery(".main-content-wrapper #search-pod-results").html(data);

                                if($('.searchpod1').length>0){
                                $('.searchpod1 .pod1 span.more-icon').hide();
                                $('.searchpod1 .pod1 span.more-text').addClass('podsearch');
                                $('.searchpod1 .pod1 .post-footer').addClass('podfooter');
                                $('.searchpod1 .pod1 .post-body-in').addClass('podbody'); 
                                $('.template_secondaryPage .hero-white .container-fluid.container-fluid-main').css('padding','0');    
                                }
                             onYouTubeIframeAPIReady();
						setTimeout(function(){
                    $('.searchpod1 li.page-item.event-page-1').addClass('active'); }, 500);
						 $('li.post-small.block-white.block').hide();
                     $('li.post-small.block-white.block').slice( 10, 10 ).show();
                         },
                         error: function() {
                                }
                            });
                    }
                });
				
	jQuery("header #search_submit").click(function (event) {
            event.preventDefault();
            var clicked = true;
            var resultinsamepage = $("header #resultinsamepage").val();
            var q = $("header #search_value").val().trim();
			var searchElem= $(this).parent().find('.show-search-error');
			if(!validateSearchInput(q) && q.length>=2){
				searchElem.html(validationMsg);
				searchElem.removeClass('hidden');
				return false;
			} else if(q.length<2){
				searchElem.html(minLengthMsg);
				searchElem.removeClass('hidden');
				return false;
			}		
			var resultperpage = $('header #resultperpage').val();
			var searchresultresponsepath = $("header #searchresultsresppath").val();
			var redirectpage = $("header #resultPage").val();
			if(resultinsamepage == "true"){
						window.location.replace(redirectpage+".html?searchterm="+q+"&resultperpage="+resultperpage);
                    }else {
						var url = searchresultresponsepath+".searchresults.html?searchterm="+q+"&resultperpage="+resultperpage;
                  jQuery.ajax({
                         url: url,
                         method: "GET",
                         success: function(data) {   
								if(!$('header').find('.show-search-error').hasClass('hidden')){
									$('header').find('.show-search-error').addClass('hidden');
								}
								$('.clearexisting').empty();
								var newurl = window.location.protocol + "//" + window.location.host + window.location.pathname+"?searchterm="+q+"&resultperpage="+resultperpage;
								window.history.pushState({path:newurl},'',newurl);
                                 jQuery("#search-pod-results").html(data);
						setTimeout(function(){
                    $('.searchpod1 li.page-item.event-page-1').addClass('active'); }, 500);
						 $('li.post-small.block-white.block').hide();
                     $('li.post-small.block-white.block').slice( 10, 10 ).show();
                         },
                         error: function() {
                                }
                            });
                   }
                });
	function validateSearchInput(searchInput) {
        var searchRegex = /^[0-9a-zA-Z, ]+[0-9a-zA-Z]{1}$/;
		if(searchInput && searchRegex.test(searchInput)) {
			return true;
		}
		return false;           
    }
});	 